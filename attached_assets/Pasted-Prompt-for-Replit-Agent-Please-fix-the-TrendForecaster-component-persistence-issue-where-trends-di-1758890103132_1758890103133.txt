Prompt for Replit Agent:

Please fix the TrendForecaster component persistence issue where trends disappear on page refresh while maintaining manual-only refresh behavior.

Current Problem:

TrendForecaster fetches from /api/trend-forecast/:niche but data isn't persisted properly
Data disappears on page refresh because component relies only on React Query cache
Component has automatic fetching disabled (which is good) but doesn't read from the database
Required Changes:

Update TrendForecaster component (client/src/components/TrendForecaster.tsx):

Modify the query to first check for existing cached data from the database
Change the queryFn to read from trend history when available
Only fetch fresh data from Perplexity when explicitly requested via "Refresh" button
Update the query key to include database lookup: ['/api/trend-history', 'trend_forecaster', selectedNiche]
Create new API endpoint (server/api/trend-history.ts):

Add GET route: /api/trend-history/forecaster/:niche
Return the latest trend forecast data for the specified niche from trendHistory table
Filter by sourceType: 'trend_forecaster' and requested niche
Format the response to match the existing TrendForecast interface structure
Group by trend categories (hot, rising, upcoming, declining)
Update the component logic:

Primary query: Read existing data from trend history database
Manual refresh: Call the existing Perplexity API and invalidate the history cache
Show "last updated" timestamp from database data
Maintain the disabled automatic fetching behavior
Response format for new endpoint:

{
  "success": true,
  "data": {
    "trends": {
      "hot": [...],
      "rising": [...], 
      "upcoming": [...],
      "declining": [...]
    },
    "niche": "beauty",
    "lastUpdated": "2025-09-26T12:33:27.000Z",
    "source": "database"
  }
}
Update refresh flow:

Keep existing manual refresh that calls /api/trend-forecast/:niche
After successful Perplexity fetch, invalidate the trend history cache
Component should automatically show the newly saved data from database
Acceptance Criteria:
✅ Trends persist across page refreshes by reading from database first
✅ Manual refresh still works and fetches fresh data from Perplexity
✅ No automatic fetching on component mount or window focus
✅ "Last updated" shows actual database timestamp
✅ All existing functionality maintained (niche switching, trend categories)
✅ Loading states work properly for both database reads and Perplexity fetches

Files to modify:

client/src/components/TrendForecaster.tsx - Update query logic and data source
server/api/trend-history.ts - Add new forecaster-specific endpoint